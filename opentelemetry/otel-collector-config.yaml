# ========================================
# OpenTelemetry Collector Configuration
# ========================================

# -----------------------
# Receivers - how collector receives telemetry
# -----------------------
receivers:
  # OTLP (Traces + Metrics) from your app
  otlp:
    protocols:
      grpc:
        endpoint: "0.0.0.0:4317"
      http:
        endpoint: "0.0.0.0:4318"

  # Prometheus metrics from app or exporters
  prometheus:
    config:
      scrape_configs:
        - job_name: "otel-app"
          scrape_interval: 10s
          static_configs:
            - targets: ["0.0.0.0:8888"]

  # File-based logs
  filelog:
    include: ["/var/log/**/*.log"]
    start_at: beginning

# -----------------------
# Processors - how telemetry is processed
# -----------------------
processors:
  # Add attributes to all telemetry (traces, metrics, logs)
  attributes:
    actions:
      - key: environment
        value: production
        action: insert

  # Batch spans/metrics/logs to reduce overhead
  batch:
    timeout: 1s
    send_batch_size: 1024

# -----------------------
# Exporters - where to send telemetry
# -----------------------
exporters:
  # Traces: Zipkin
  zipkin:
    endpoint: "http://zipkin:9411/api/v2/spans"
    format: proto

  # Metrics: Prometheus endpoint
  prometheus:
    endpoint: "0.0.0.0:9464"

  # Logs + Debug
  debug:
    verbosity: detailed

# -----------------------
# Extensions - optional functionality
# -----------------------
extensions:
  health_check:    # Health endpoint
  pprof:           # Profiling
    endpoint: :1888
  zpages:          # Diagnostic pages
    endpoint: :55679

# -----------------------
# Service - tie together receivers, processors, exporters
# -----------------------
service:
  extensions: [pprof, zpages, health_check]

  pipelines:
    # Traces pipeline
    traces:
      receivers: [otlp]
      processors: [batch, attributes]
      exporters: [zipkin, debug]

    # Metrics pipeline
    metrics:
      receivers: [prometheus, otlp]
      processors: [batch, attributes]
      exporters: [prometheus, debug]

    # Logs pipeline
    logs:
      receivers: [filelog, otlp]
      processors: [batch, attributes]
      exporters: [debug]
